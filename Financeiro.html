<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FluxoMaster Pro - Sistema ERP Completo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #6C63FF;
            --primary-dark: #5A52D3;
            --primary-light: #E9E8FF;
            --secondary: #FF6584;
            --success: #4CC9A7;
            --warning: #FFB74D;
            --danger: #FF5A5F;
            --info: #36B5E8;
            --light: #F8F9FF;
            --dark: #2D3047;
            --gray: #8C8CA1;
            --gray-light: #EFF1F8;
            --border-radius: 16px;
            --border-radius-sm: 10px;
            --box-shadow: 0 12px 32px rgba(108, 99, 255, 0.1);
            --box-shadow-lg: 0 20px 60px rgba(108, 99, 255, 0.15);
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
            --gradient-primary: linear-gradient(135deg, #6C63FF 0%, #8A84FF 100%);
            --gradient-success: linear-gradient(135deg, #4CC9A7 0%, #6AE8C9 100%);
            --gradient-danger: linear-gradient(135deg, #FF5A5F 0%, #FF7B80 100%);
            --gradient-warning: linear-gradient(135deg, #FFB74D 0%, #FFCC80 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #F8F9FF 0%, #F0F2FF 100%);
            color: var(--dark);
            min-height: 100vh;
            display: flex;
            position: relative;
            overflow-x: hidden;
        }

        /* Decoração de fundo */
        .bg-decoration {
            position: fixed;
            z-index: -1;
            opacity: 0.1;
        }

        .bg-circle-1 {
            width: 600px;
            height: 600px;
            border-radius: 50%;
            background: var(--primary);
            filter: blur(100px);
            top: -300px;
            right: -200px;
        }

        .bg-circle-2 {
            width: 400px;
            height: 400px;
            border-radius: 50%;
            background: var(--secondary);
            filter: blur(80px);
            bottom: -200px;
            left: -100px;
        }

        /* Sidebar Premium */
        .sidebar {
            width: 320px;
            background: white;
            padding: 0;
            display: flex;
            flex-direction: column;
            box-shadow: var(--box-shadow);
            z-index: 100;
            position: relative;
            border-right: 1px solid var(--gray-light);
            transition: var(--transition);
        }

        .sidebar:hover {
            box-shadow: var(--box-shadow-lg);
        }

        .logo-container {
            padding: 40px 30px 30px;
            background: var(--gradient-primary);
            position: relative;
            overflow: hidden;
        }

        .logo-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .logo {
            display: flex;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .logo-icon i {
            font-size: 28px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-text {
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            font-size: 28px;
            color: white;
            letter-spacing: -0.5px;
        }

        .logo-subtext {
            font-size: 12px;
            color: rgba(255,255,255,0.9);
            font-weight: 300;
            letter-spacing: 2px;
            margin-top: 5px;
        }

        .user-profile {
            padding: 30px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--gray-light);
            position: relative;
        }

        .user-avatar {
            width: 70px;
            height: 70px;
            border-radius: 20px;
            overflow: hidden;
            border: 4px solid white;
            box-shadow: 0 8px 20px rgba(108, 99, 255, 0.2);
            margin-right: 20px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .user-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 30px rgba(108, 99, 255, 0.3);
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-placeholder {
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
        }

        #avatar-input {
            display: none;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .user-role {
            font-size: 13px;
            color: var(--gray);
            background: var(--primary-light);
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            font-weight: 500;
        }

        .user-status {
            display: flex;
            align-items: center;
            margin-top: 8px;
            font-size: 12px;
            color: var(--success);
            font-weight: 500;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .nav-list {
            list-style: none;
            padding: 30px 20px;
            flex: 1;
        }

        .nav-item {
            padding: 18px 25px;
            margin-bottom: 12px;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .nav-item:hover {
            background: var(--primary-light);
            transform: translateX(5px);
        }

        .nav-item.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 8px 20px rgba(108, 99, 255, 0.3);
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: white;
            border-radius: 0 4px 4px 0;
        }

        .nav-icon {
            font-size: 22px;
            margin-right: 18px;
            width: 30px;
            text-align: center;
        }

        .nav-text {
            font-weight: 600;
            font-size: 15px;
            flex: 1;
        }

        .nav-badge {
            background: white;
            color: var(--primary);
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 700;
        }

        .nav-item.active .nav-badge {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .sidebar-footer {
            padding: 25px 30px;
            border-top: 1px solid var(--gray-light);
            background: var(--light);
        }

        .system-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .storage-bar {
            height: 6px;
            background: var(--gray-light);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .storage-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 3px;
            width: 65%;
            transition: width 1s ease;
        }

        .storage-text {
            font-size: 12px;
            color: var(--gray);
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            position: relative;
        }

        .page-header::after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, var(--primary) 0%, transparent 100%);
            opacity: 0.2;
        }

        .page-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 36px;
            font-weight: 800;
            color: var(--dark);
            display: flex;
            align-items: center;
        }

        .page-title i {
            margin-right: 20px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 40px;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .date-info {
            background: white;
            padding: 12px 24px;
            border-radius: var(--border-radius-sm);
            box-shadow: var(--box-shadow);
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
        }

        .date-info i {
            margin-right: 10px;
            color: var(--primary);
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .stat-card {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid transparent;
        }

        .stat-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--box-shadow-lg);
            border-color: var(--primary-light);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 8px;
            height: 100%;
        }

        .stat-card.entrada::before {
            background: var(--success);
        }

        .stat-card.saida::before {
            background: var(--danger);
        }

        .stat-card.saldo::before {
            background: var(--primary);
        }

        .stat-card.clientes::before {
            background: var(--info);
        }

        .stat-icon {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 25px;
            color: white;
            font-size: 36px;
            flex-shrink: 0;
        }

        .stat-card.entrada .stat-icon {
            background: var(--gradient-success);
        }

        .stat-card.saida .stat-icon {
            background: var(--gradient-danger);
        }

        .stat-card.saldo .stat-icon {
            background: var(--gradient-primary);
        }

        .stat-card.clientes .stat-icon {
            background: linear-gradient(135deg, var(--info) 0%, #64D7FF 100%);
        }

        .stat-info {
            flex: 1;
        }

        .stat-label {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .stat-change {
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        .stat-change.neutral {
            color: var(--gray);
        }

        .stat-change i {
            margin-right: 5px;
        }

        /* Cards Premium */
        .card {
            background: white;
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 40px;
            transition: var(--transition);
            border: 1px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            box-shadow: var(--box-shadow-lg);
            border-color: var(--primary-light);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 35px;
        }

        .card-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
        }

        .card-title i {
            margin-right: 15px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 28px;
        }

        .card-actions {
            display: flex;
            gap: 12px;
        }

        /* Botões Premium */
        .btn {
            padding: 14px 28px;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            border: none;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            letter-spacing: 0.3px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(108, 99, 255, 0.3);
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
        }

        .btn-warning {
            background: var(--gradient-warning);
            color: var(--dark);
        }

        .btn-danger {
            background: var(--gradient-danger);
            color: white;
        }

        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
        }

        .btn-sm {
            padding: 10px 20px;
            font-size: 13px;
        }

        .btn-icon {
            width: 46px;
            height: 46px;
            padding: 0;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Forms Premium */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark);
            display: flex;
            align-items: center;
        }

        .input-label i {
            margin-right: 8px;
            color: var(--primary);
        }

        .form-control {
            padding: 16px 20px;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius-sm);
            font-family: 'Poppins', sans-serif;
            font-size: 15px;
            transition: var(--transition);
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(108, 99, 255, 0.1);
            transform: translateY(-2px);
        }

        .form-actions {
            display: flex;
            gap: 20px;
            margin-top: 35px;
            padding-top: 30px;
            border-top: 1px solid var(--gray-light);
        }

        /* Tables Premium */
        .table-container {
            overflow-x: auto;
            border-radius: var(--border-radius);
            box-shadow: 0 8px 20px rgba(0,0,0,0.04);
            border: 1px solid var(--gray-light);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }

        thead {
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
        }

        th {
            padding: 22px 20px;
            text-align: left;
            color: white;
            font-weight: 600;
            font-size: 15px;
            letter-spacing: 0.5px;
        }

        th:first-child {
            border-top-left-radius: var(--border-radius);
            padding-left: 30px;
        }

        th:last-child {
            border-top-right-radius: var(--border-radius);
            padding-right: 30px;
        }

        td {
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
            font-size: 15px;
        }

        td:first-child {
            padding-left: 30px;
        }

        td:last-child {
            padding-right: 30px;
        }

        tbody tr {
            transition: var(--transition);
        }

        tbody tr:hover {
            background-color: rgba(108, 99, 255, 0.03);
            transform: translateX(5px);
        }

        /* Tags */
        .tag {
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: 700;
            display: inline-block;
            letter-spacing: 0.3px;
        }

        .tag-entrada {
            background: rgba(76, 201, 167, 0.1);
            color: var(--success);
            border: 1px solid rgba(76, 201, 167, 0.2);
        }

        .tag-saida {
            background: rgba(255, 90, 95, 0.1);
            color: var(--danger);
            border: 1px solid rgba(255, 90, 95, 0.2);
        }

        /* Modal Premium */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(45, 48, 71, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--box-shadow-lg);
            animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 30px 40px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(90deg, var(--primary) 0%, transparent 100%);
            background-size: 200% 100%;
            animation: gradientShift 3s ease infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .modal-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 28px;
            font-weight: 700;
            color: white;
        }

        .modal-close {
            background: rgba(255,255,255,0.2);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 20px;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 40px;
        }

        /* Photo Upload Premium */
        .photo-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px;
            border: 3px dashed var(--primary-light);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            background: var(--light);
            position: relative;
            overflow: hidden;
        }

        .photo-upload:hover {
            border-color: var(--primary);
            background: white;
            transform: translateY(-5px);
        }

        .photo-preview {
            width: 150px;
            height: 150px;
            border-radius: 25px;
            overflow: hidden;
            margin-bottom: 25px;
            border: 5px solid white;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            position: relative;
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .upload-icon {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient-primary);
            color: white;
            font-size: 50px;
        }

        .upload-text {
            font-size: 16px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .upload-subtext {
            font-size: 13px;
            color: var(--gray);
            margin-bottom: 25px;
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(108, 99, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            padding: 20px 25px;
            border-radius: var(--border-radius-sm);
            box-shadow: var(--box-shadow-lg);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1001;
            transform: translateY(100px);
            opacity: 0;
            transition: var(--transition);
            max-width: 400px;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            flex-shrink: 0;
        }

        .toast-success .toast-icon {
            background: var(--gradient-success);
        }

        .toast-error .toast-icon {
            background: var(--gradient-danger);
        }

        .toast-info .toast-icon {
            background: var(--gradient-primary);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .toast-message {
            font-size: 14px;
            color: var(--gray);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 18px;
            padding: 0;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .sidebar {
                width: 280px;
            }
            
            .main-content {
                padding: 30px;
            }
            
            .page-title {
                font-size: 30px;
            }
        }

        @media (max-width: 992px) {
            body {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                padding: 0;
            }
            
            .nav-list {
                display: flex;
                overflow-x: auto;
                padding: 20px;
            }
            
            .nav-item {
                flex-shrink: 0;
                margin-bottom: 0;
                margin-right: 10px;
                padding: 15px 20px;
            }
            
            .user-profile {
                display: none;
            }
            
            .sidebar-footer {
                display: none;
            }
            
            .quick-stats {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 20px;
            }
            
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .card {
                padding: 30px 20px;
            }
            
            .modal-body {
                padding: 30px 20px;
            }
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 60px 40px;
        }

        .empty-icon {
            width: 100px;
            height: 100px;
            background: var(--primary-light);
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            color: var(--primary);
            font-size: 40px;
        }

        .empty-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 15px;
        }

        .empty-text {
            color: var(--gray);
            margin-bottom: 30px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-light);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* Gráficos */
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }

        .chart-filter-container {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .chart-filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chart-type-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .chart-type-btn {
            padding: 8px 16px;
            border-radius: 8px;
            background: var(--light);
            border: 2px solid var(--gray-light);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }

        .chart-type-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .chart-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .chart-summary-card {
            background: var(--light);
            padding: 20px;
            border-radius: var(--border-radius-sm);
            text-align: center;
        }

        .chart-summary-value {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .chart-summary-label {
            font-size: 12px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .date-range-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* Erro nos inputs */
        .form-control.error {
            border-color: var(--danger);
            background: rgba(255, 90, 95, 0.05);
        }

        .error-message {
            color: var(--danger);
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .form-control.error + .error-message {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Decorações de fundo -->
    <div class="bg-decoration bg-circle-1"></div>
    <div class="bg-decoration bg-circle-2"></div>
    
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo-container">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-chart-network"></i>
                </div>
                <div>
                    <div class="logo-text">FluxoMaster</div>
                    <div class="logo-subtext">ERP PREMIUM</div>
                </div>
            </div>
        </div>
        
        <div class="user-profile">
            <div class="user-avatar" id="avatar-container" onclick="openAvatarModal()">
                <div class="avatar-placeholder">
                    <i class="fas fa-user" id="avatar-icon"></i>
                </div>
                <input type="file" id="avatar-input" accept="image/*">
            </div>
            <div class="user-info">
                <div class="user-name" id="user-name">Administrador</div>
                <div class="user-role">Plano Premium</div>
                <div class="user-status">
                    <div class="status-dot"></div>
                    Sistema Online
                </div>
            </div>
        </div>
        
        <ul class="nav-list">
            <li class="nav-item active" onclick="showSection('dash')">
                <div class="nav-icon"><i class="fas fa-tachometer-alt"></i></div>
                <div class="nav-text">Dashboard</div>
                <div class="nav-badge" id="dashboard-badge">VIP</div>
            </li>
            <li class="nav-item" onclick="showSection('clientes')">
                <div class="nav-icon"><i class="fas fa-users"></i></div>
                <div class="nav-text">Clientes</div>
                <div class="nav-badge" id="clientes-badge">0</div>
            </li>
            <li class="nav-item" onclick="showSection('financeiro')">
                <div class="nav-icon"><i class="fas fa-money-bill-wave"></i></div>
                <div class="nav-text">Financeiro</div>
                <div class="nav-badge" id="financeiro-badge">0</div>
            </li>
            <li class="nav-item" onclick="showSection('categorias')">
                <div class="nav-icon"><i class="fas fa-tags"></i></div>
                <div class="nav-text">Categorias</div>
                <div class="nav-badge" id="categorias-badge">7</div>
            </li>
            <li class="nav-item" onclick="showSection('relatorios')">
                <div class="nav-icon"><i class="fas fa-chart-pie"></i></div>
                <div class="nav-text">Relatórios</div>
                <div class="nav-badge">NEW</div>
            </li>
            <li class="nav-item" onclick="showSection('configuracoes')">
                <div class="nav-icon"><i class="fas fa-cogs"></i></div>
                <div class="nav-text">Configurações</div>
            </li>
        </ul>
        
        <div class="sidebar-footer">
            <div class="system-info">
                <div style="font-weight: 600; color: var(--dark);">Armazenamento</div>
                <div style="font-size: 12px; color: var(--success);">65% Livre</div>
            </div>
            <div class="storage-bar">
                <div class="storage-fill"></div>
            </div>
            <div class="storage-text">Dados seguros • Backup automático</div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard -->
        <div id="sec-dash" class="section">
            <div class="page-header">
                <div class="page-title">
                    <i class="fas fa-tachometer-alt"></i>
                    <div>Dashboard Premium</div>
                </div>
                <div class="header-actions">
                    <div class="date-info">
                        <i class="far fa-calendar-alt"></i>
                        <span id="current-date"></span>
                    </div>
                    <button class="btn btn-primary" onclick="openAddTransactionModal()">
                        <i class="fas fa-plus"></i> Rápido
                    </button>
                </div>
            </div>
            
            <div class="quick-stats">
                <div class="stat-card entrada">
                    <div class="stat-icon">
                        <i class="fas fa-arrow-down"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-label">Total Recebido</div>
                        <div class="stat-value" id="total-in">R$ 0,00</div>
                        <div class="stat-change">
                            <i class="fas fa-calendar"></i> Este mês
                        </div>
                    </div>
                </div>
                
                <div class="stat-card saida">
                    <div class="stat-icon">
                        <i class="fas fa-arrow-up"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-label">Total Gastos</div>
                        <div class="stat-value" id="total-out">R$ 0,00</div>
                        <div class="stat-change">
                            <i class="fas fa-calendar"></i> Este mês
                        </div>
                    </div>
                </div>
                
                <div class="stat-card saldo">
                    <div class="stat-icon">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-label">Saldo Atual</div>
                        <div class="stat-value" id="total-saldo">R$ 0,00</div>
                        <div class="stat-change">
                            <i class="fas fa-chart-line"></i> Atualizado
                        </div>
                    </div>
                </div>
                
                <div class="stat-card clientes">
                    <div class="stat-icon">
                        <i class="fas fa-user-friends"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-label">Clientes Ativos</div>
                        <div class="stat-value" id="total-clientes">0</div>
                        <div class="stat-change">
                            <i class="fas fa-user-plus"></i> Total
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-history"></i> Últimas Movimentações
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-outline btn-sm" onclick="showSection('financeiro')">
                            <i class="fas fa-exchange-alt"></i> Ver Tudo
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="openAddTransactionModal()">
                            <i class="fas fa-plus"></i> Adicionar
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="tab-resumo">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Fluxo</th>
                                <th>Descrição</th>
                                <th>Categoria</th>
                                <th>Valor</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="dashboard-transactions">
                            <!-- Preenchido via JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div id="empty-dashboard" class="empty-state" style="display: none;">
                    <div class="empty-icon">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <div class="empty-title">Nenhuma movimentação ainda</div>
                    <div class="empty-text">Comece adicionando sua primeira entrada ou saída financeira</div>
                    <button class="btn btn-primary" onclick="openAddTransactionModal()">
                        <i class="fas fa-plus"></i> Adicionar Primeira Movimentação
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-chart-line"></i> Visão Rápida do Mês
                    </div>
                    <div class="card-actions">
                        <select class="form-control" style="width: 200px;" onchange="filterDashboard(this.value)">
                            <option value="all">Todos os Períodos</option>
                            <option value="today">Hoje</option>
                            <option value="week">Esta Semana</option>
                            <option value="month" selected>Este Mês</option>
                            <option value="year">Este Ano</option>
                        </select>
                    </div>
                </div>
                <div style="padding: 20px;">
                    <div style="display: flex; align-items: center; justify-content: center; height: 200px;">
                        <div style="text-align: center;">
                            <div style="font-size: 48px; font-weight: 800; color: var(--primary); margin-bottom: 10px;" id="month-balance">R$ 0,00</div>
                            <div style="color: var(--gray);">Saldo do mês atual</div>
                            <div style="display: flex; justify-content: center; gap: 40px; margin-top: 30px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 20px; font-weight: 700; color: var(--success);" id="month-income">R$ 0,00</div>
                                    <div style="font-size: 13px; color: var(--gray);">Entradas</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 20px; font-weight: 700; color: var(--danger);" id="month-expenses">R$ 0,00</div>
                                    <div style="font-size: 13px; color: var(--gray);">Saídas</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Clientes (com CRUD completo) -->
        <div id="sec-clientes" class="section" style="display:none">
            <div class="page-header">
                <div class="page-title">
                    <i class="fas fa-users"></i>
                    <div>Gestão de Clientes</div>
                </div>
                <div class="header-actions">
                    <div class="date-info">
                        <i class="fas fa-user-friends"></i>
                        <span id="client-count">0 clientes</span>
                    </div>
                    <button class="btn btn-primary" onclick="openClientModal()">
                        <i class="fas fa-user-plus"></i> Novo Cliente
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-list"></i> Todos os Clientes
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-outline btn-sm" onclick="exportClientes()">
                            <i class="fas fa-download"></i> Exportar
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="importClientes()">
                            <i class="fas fa-upload"></i> Importar
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="tab-clientes">
                        <thead>
                            <tr>
                                <th>Cliente</th>
                                <th>Contato</th>
                                <th>Localização</th>
                                <th>Última Mov.</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="clientes-body">
                            <!-- Preenchido via JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div id="empty-clientes" class="empty-state" style="display: none;">
                    <div class="empty-icon">
                        <i class="fas fa-user-friends"></i>
                    </div>
                    <div class="empty-title">Nenhum cliente cadastrado</div>
                    <div class="empty-text">Adicione clientes para organizar suas transações e ter um histórico completo</div>
                    <button class="btn btn-primary" onclick="openClientModal()">
                        <i class="fas fa-user-plus"></i> Adicionar Primeiro Cliente
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Financeiro -->
        <div id="sec-financeiro" class="section" style="display:none">
            <div class="page-header">
                <div class="page-title">
                    <i class="fas fa-money-bill-wave"></i>
                    <div>Gestão Financeira</div>
                </div>
                <div class="header-actions">
                    <div class="date-info">
                        <i class="far fa-clock"></i>
                        <span>Atualizado: <span id="last-update">Agora</span></span>
                    </div>
                    <button class="btn btn-primary" onclick="openAddTransactionModal()">
                        <i class="fas fa-plus"></i> Nova Movimentação
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-filter"></i> Filtros Avançados
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-outline btn-sm" onclick="clearFilters()">
                            <i class="fas fa-times"></i> Limpar Filtros
                        </button>
                    </div>
                </div>
                <div class="form-grid" style="margin-bottom: 0;">
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-calendar"></i> Período</label>
                        <select id="filter-period" class="form-control" onchange="toggleCustomDateRange()">
                            <option value="all">Todo Período</option>
                            <option value="today">Hoje</option>
                            <option value="week">Última Semana</option>
                            <option value="month" selected>Este Mês</option>
                            <option value="quarter">Este Trimestre</option>
                            <option value="year">Este Ano</option>
                            <option value="custom">Personalizado</option>
                        </select>
                    </div>
                    <div class="input-group" id="custom-date-range" style="display: none;">
                        <label class="input-label"><i class="fas fa-calendar-alt"></i> Período Personalizado</label>
                        <div class="date-range-inputs">
                            <input type="date" id="filter-date-from" class="form-control">
                            <span>até</span>
                            <input type="date" id="filter-date-to" class="form-control">
                        </div>
                    </div>
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-exchange-alt"></i> Tipo</label>
                        <select id="filter-type" class="form-control">
                            <option value="all">Todos os Tipos</option>
                            <option value="Entrada">Apenas Entradas</option>
                            <option value="Saída">Apenas Saídas</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-tag"></i> Categoria</label>
                        <select id="filter-category" class="form-control">
                            <option value="all">Todas Categorias</option>
                            <!-- Preenchido via JavaScript -->
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-user"></i> Cliente</label>
                        <select id="filter-client" class="form-control">
                            <option value="all">Todos Clientes</option>
                            <!-- Preenchido via JavaScript -->
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-sort-amount-down"></i> Ordenar por</label>
                        <select id="filter-sort" class="form-control">
                            <option value="date-desc">Data (Mais Recente)</option>
                            <option value="date-asc">Data (Mais Antiga)</option>
                            <option value="value-desc">Valor (Maior)</option>
                            <option value="value-asc">Valor (Menor)</option>
                        </select>
                    </div>
                    <div class="input-group" style="align-self: flex-end;">
                        <button class="btn btn-primary" onclick="applyFilters()" style="width: 100%;">
                            <i class="fas fa-filter"></i> Aplicar Filtros
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-exchange-alt"></i> Todas as Movimentações
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-outline btn-sm" onclick="printTransactions()">
                            <i class="fas fa-print"></i> Imprimir
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="exportTransactions()">
                            <i class="fas fa-file-export"></i> Exportar
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="tab-financas">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Tipo</th>
                                <th>Descrição</th>
                                <th>Categoria</th>
                                <th>Cliente</th>
                                <th>Valor</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="transactions-body">
                            <!-- Preenchido via JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div id="empty-transactions" class="empty-state" style="display: none;">
                    <div class="empty-icon">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <div class="empty-title">Nenhuma movimentação encontrada</div>
                    <div class="empty-text">Tente ajustar os filtros ou adicione uma nova movimentação</div>
                    <button class="btn btn-primary" onclick="openAddTransactionModal()">
                        <i class="fas fa-plus"></i> Adicionar Movimentação
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Categorias (com CRUD completo) -->
        <div id="sec-categorias" class="section" style="display:none">
            <div class="page-header">
                <div class="page-title">
                    <i class="fas fa-tags"></i>
                    <div>Gestão de Categorias</div>
                </div>
                <div class="header-actions">
                    <div class="date-info">
                        <i class="fas fa-hashtag"></i>
                        <span id="categoria-count">7 categorias</span>
                    </div>
                    <button class="btn btn-primary" onclick="openCategoryModal()">
                        <i class="fas fa-plus"></i> Nova Categoria
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-palette"></i> Personalize suas Categorias
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-outline btn-sm" onclick="resetDefaultCategories()">
                            <i class="fas fa-redo"></i> Restaurar Padrão
                        </button>
                    </div>
                </div>
                <div class="form-grid" style="margin-bottom: 0;">
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-filter"></i> Filtrar por Tipo</label>
                        <select id="filter-category-type" class="form-control" onchange="filterCategories()">
                            <option value="all">Todas as Categorias</option>
                            <option value="Entrada">Apenas Entradas</option>
                            <option value="Saída">Apenas Saídas</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-search"></i> Buscar Categoria</label>
                        <input type="text" class="form-control" placeholder="Digite para buscar..." onkeyup="searchCategories(this.value)">
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-list"></i> Categorias Cadastradas
                    </div>
                </div>
                <div class="table-container">
                    <table id="tab-categorias">
                        <thead>
                            <tr>
                                <th>Categoria</th>
                                <th>Tipo</th>
                                <th>Cor</th>
                                <th>Transações</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="categories-body">
                            <!-- Preenchido via JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div id="empty-categories" class="empty-state" style="display: none;">
                    <div class="empty-icon">
                        <i class="fas fa-tags"></i>
                    </div>
                    <div class="empty-title">Nenhuma categoria cadastrada</div>
                    <div class="empty-text">Crie categorias para organizar melhor suas transações financeiras</div>
                    <button class="btn btn-primary" onclick="openCategoryModal()">
                        <i class="fas fa-plus"></i> Criar Primeira Categoria
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Relatórios -->
        <div id="sec-relatorios" class="section" style="display:none">
            <div class="page-header">
                <div class="page-title">
                    <i class="fas fa-chart-pie"></i>
                    <div>Relatórios Analíticos</div>
                </div>
                <div class="header-actions">
                    <div class="date-info">
                        <i class="fas fa-calendar"></i>
                        <span id="report-period-label">Este Mês</span>
                    </div>
                    <button class="btn btn-primary" onclick="generatePDFReport()">
                        <i class="fas fa-file-pdf"></i> Gerar PDF
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-chart-bar"></i> Gráfico de Movimentações
                    </div>
                    <div class="card-actions">
                        <div class="chart-filter-container">
                            <div class="chart-filter-group">
                                <select class="form-control" id="chart-period" onchange="updateChart()">
                                    <option value="daily">Diário</option>
                                    <option value="weekly">Semanal</option>
                                    <option value="monthly" selected>Mensal</option>
                                    <option value="yearly">Anual</option>
                                    <option value="custom">Período Personalizado</option>
                                </select>
                                <div id="chart-custom-range" class="date-range-inputs" style="display: none;">
                                    <input type="date" id="chart-date-from" class="form-control">
                                    <span>até</span>
                                    <input type="date" id="chart-date-to" class="form-control">
                                </div>
                            </div>
                            <div class="chart-type-buttons">
                                <button class="chart-type-btn active" onclick="changeChartType('bar')">Barras</button>
                                <button class="chart-type-btn" onclick="changeChartType('line')">Linhas</button>
                                <button class="chart-type-btn" onclick="changeChartType('pie')">Pizza</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="transactions-chart"></canvas>
                </div>
                <div class="chart-summary">
                    <div class="chart-summary-card">
                        <div class="chart-summary-value" id="chart-total-income">R$ 0,00</div>
                        <div class="chart-summary-label" style="color: var(--success);">Total Entradas</div>
                    </div>
                    <div class="chart-summary-card">
                        <div class="chart-summary-value" id="chart-total-expenses">R$ 0,00</div>
                        <div class="chart-summary-label" style="color: var(--danger);">Total Saídas</div>
                    </div>
                    <div class="chart-summary-card">
                        <div class="chart-summary-value" id="chart-balance">R$ 0,00</div>
                        <div class="chart-summary-label" style="color: var(--primary);">Saldo Líquido</div>
                    </div>
                    <div class="chart-summary-card">
                        <div class="chart-summary-value" id="chart-transaction-count">0</div>
                        <div class="chart-summary-label" style="color: var(--info);">Total Transações</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-table"></i> Análise por Categoria
                    </div>
                </div>
                <div class="table-container">
                    <table id="tab-relatorios">
                        <thead>
                            <tr>
                                <th>Categoria</th>
                                <th>Tipo</th>
                                <th>Quantidade</th>
                                <th>Valor Total</th>
                                <th>% do Total</th>
                            </tr>
                        </thead>
                        <tbody id="report-body">
                            <!-- Preenchido via JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div id="empty-report" class="empty-state" style="display: none;">
                    <div class="empty-icon">
                        <i class="fas fa-chart-pie"></i>
                    </div>
                    <div class="empty-title">Sem dados para análise</div>
                    <div class="empty-text">Adicione transações para gerar relatórios analíticos</div>
                </div>
            </div>
        </div>
        
        <!-- Configurações -->
        <div id="sec-configuracoes" class="section" style="display:none">
            <div class="page-header">
                <div class="page-title">
                    <i class="fas fa-cogs"></i>
                    <div>Configurações do Sistema</div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="backupData()">
                        <i class="fas fa-database"></i> Backup
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-user-cog"></i> Configurações de Perfil
                    </div>
                </div>
                <div class="form-grid">
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-user"></i> Nome do Usuário</label>
                        <input type="text" class="form-control" id="config-username" value="Administrador">
                    </div>
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-envelope"></i> E-mail</label>
                        <input type="email" class="form-control" id="config-email" placeholder="seu@email.com">
                    </div>
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-building"></i> Empresa</label>
                        <input type="text" class="form-control" id="config-company" placeholder="Nome da sua empresa">
                    </div>
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-map-marker-alt"></i> Cidade Padrão</label>
                        <input type="text" class="form-control" id="config-city" value="Jaraguá do Sul">
                    </div>
                </div>
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="saveSettings()">
                        <i class="fas fa-save"></i> Salvar Configurações
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-shield-alt"></i> Segurança e Dados
                    </div>
                </div>
                <div style="padding: 30px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                        <div>
                            <h4 style="margin-bottom: 20px; color: var(--dark);">Exportar Dados</h4>
                            <p style="color: var(--gray); margin-bottom: 20px;">Faça backup de todos os dados do sistema</p>
                            <button class="btn btn-outline" onclick="exportAllData()">
                                <i class="fas fa-download"></i> Exportar Tudo
                            </button>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 20px; color: var(--dark);">Importar Dados</h4>
                            <p style="color: var(--gray); margin-bottom: 20px;">Restaurar dados de um backup anterior</p>
                            <button class="btn btn-outline" onclick="importAllData()">
                                <i class="fas fa-upload"></i> Importar Backup
                            </button>
                        </div>
                    </div>
                    <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid var(--gray-light);">
                        <h4 style="margin-bottom: 20px; color: var(--dark);">Zona de Perigo</h4>
                        <p style="color: var(--gray); margin-bottom: 20px;">Ações irreversíveis. Tenha cuidado!</p>
                        <button class="btn btn-danger" onclick="resetSystemWithConfirmation()">
                            <i class="fas fa-trash"></i> Resetar Sistema
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de Upload de Foto -->
    <div class="modal" id="avatar-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Foto de Perfil</div>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="photo-upload" onclick="document.getElementById('avatar-file-input').click()">
                    <div class="photo-preview" id="modal-avatar-preview">
                        <div class="upload-icon">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                    <div class="upload-text">Clique para selecionar uma imagem</div>
                    <div class="upload-subtext">Formatos suportados: JPG, PNG, GIF • Tamanho máximo: 5MB</div>
                    <input type="file" id="avatar-file-input" accept="image/*" style="display: none;" onchange="previewAvatar(event)">
                </div>
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="saveAvatar()">
                        <i class="fas fa-save"></i> Salvar Foto
                    </button>
                    <button class="btn btn-outline" onclick="closeModal()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button class="btn btn-danger" onclick="removeAvatar()" style="margin-left: auto;">
                        <i class="fas fa-trash"></i> Remover
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de Cliente (CRUD Completo) -->
    <div class="modal" id="client-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="client-modal-title">Novo Cliente</div>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="client-form">
                    <input type="hidden" id="client-id">
                    <div class="form-grid">
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-user"></i> Nome Completo *</label>
                            <input type="text" id="client-nome" class="form-control" placeholder="Nome do cliente" required onkeypress="return lettersOnly(event)">
                            <div class="error-message">Apenas letras são permitidas</div>
                        </div>
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-phone"></i> Telefone</label>
                            <input type="tel" id="client-tel" class="form-control" placeholder="(00) 00000-0000" onkeypress="return numbersOnly(event)">
                            <div class="error-message">Apenas números são permitidos</div>
                        </div>
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-envelope"></i> E-mail</label>
                            <input type="email" id="client-email" class="form-control" placeholder="cliente@email.com">
                        </div>
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-id-card"></i> CPF/CNPJ</label>
                            <input type="text" id="client-document" class="form-control" placeholder="000.000.000-00" onkeypress="return numbersOnly(event)">
                            <div class="error-message">Apenas números são permitidos</div>
                        </div>
                        <div class="input-group" style="grid-column: span 2">
                            <label class="input-label"><i class="fas fa-map-marker-alt"></i> Endereço</label>
                            <input type="text" id="client-address" class="form-control" placeholder="Rua, número, complemento">
                        </div>
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-city"></i> Cidade</label>
                            <input type="text" id="client-city" class="form-control" value="Jaraguá do Sul" onkeypress="return lettersOnly(event)">
                            <div class="error-message">Apenas letras são permitidas</div>
                        </div>
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-flag"></i> Estado</label>
                            <select id="client-state" class="form-control">
                                <option value="SC">Santa Catarina (SC)</option>
                                <option value="PR">Paraná (PR)</option>
                                <option value="RS">Rio Grande do Sul (RS)</option>
                                <option value="SP">São Paulo (SP)</option>
                                <option value="RJ">Rio de Janeiro (RJ)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-calendar"></i> Data de Cadastro</label>
                            <input type="date" id="client-date" class="form-control">
                        </div>
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-tag"></i> Status</label>
                            <select id="client-status" class="form-control">
                                <option value="ativo" selected>Ativo</option>
                                <option value="inativo">Inativo</option>
                                <option value="potencial">Potencial</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Salvar Cliente
                        </button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal de Categoria (CRUD Completo) -->
    <div class="modal" id="category-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="category-modal-title">Nova Categoria</div>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="category-form">
                    <input type="hidden" id="category-id">
                    <div class="form-grid">
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-tag"></i> Nome da Categoria *</label>
                            <input type="text" id="category-name" class="form-control" placeholder="Ex: Vendas, Salário, Aluguel" required onkeypress="return lettersOnly(event)">
                            <div class="error-message">Apenas letras são permitidas</div>
                        </div>
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-exchange-alt"></i> Tipo *</label>
                            <select id="category-type" class="form-control" required>
                                <option value="Entrada">Entrada (Receita)</option>
                                <option value="Saída">Saída (Despesa)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-palette"></i> Cor da Categoria</label>
                            <input type="color" id="category-color" class="form-control" value="#6C63FF">
                        </div>
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-percentage"></i> Orçamento Mensal (opcional)</label>
                            <input type="number" id="category-budget" class="form-control" placeholder="Valor em R$" step="0.01" onkeypress="return numbersOnly(event)">
                            <div class="error-message">Apenas números são permitidos</div>
                        </div>
                        <div class="input-group" style="grid-column: span 2">
                            <label class="input-label"><i class="fas fa-align-left"></i> Descrição</label>
                            <textarea id="category-description" class="form-control" rows="3" placeholder="Descrição opcional da categoria"></textarea>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Salvar Categoria
                        </button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal de Transação -->
    <div class="modal" id="transaction-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="transaction-modal-title">Nova Transação</div>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="transaction-form">
                    <input type="hidden" id="transaction-id">
                    <div class="form-grid">
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-exchange-alt"></i> Tipo *</label>
                            <select id="transaction-type" class="form-control" required onchange="updateCategoryOptions()">
                                <option value="Entrada">Entrada (Receita)</option>
                                <option value="Saída">Saída (Despesa)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-tags"></i> Categoria *</label>
                            <select id="transaction-category" class="form-control" required>
                                <!-- Preenchido dinamicamente -->
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-user"></i> Cliente</label>
                            <select id="transaction-client" class="form-control">
                                <option value="">Sem Cliente</option>
                                <!-- Preenchido dinamicamente -->
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-money-bill-wave"></i> Valor (R$) *</label>
                            <input type="number" id="transaction-value" class="form-control" placeholder="0.00" step="0.01" min="0" required onkeypress="return numbersOnly(event)">
                            <div class="error-message">Apenas números são permitidos</div>
                        </div>
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-calendar"></i> Data *</label>
                            <input type="date" id="transaction-date" class="form-control" required>
                        </div>
                        <div class="input-group" style="grid-column: span 2">
                            <label class="input-label"><i class="fas fa-align-left"></i> Descrição *</label>
                            <input type="text" id="transaction-description" class="form-control" placeholder="Descreva esta transação" required>
                        </div>
                        <div class="input-group" style="grid-column: span 2">
                            <label class="input-label"><i class="fas fa-sticky-note"></i> Observações</label>
                            <textarea id="transaction-notes" class="form-control" rows="3" placeholder="Observações adicionais"></textarea>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Salvar Transação
                        </button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-icon">
            <i class="fas fa-check"></i>
        </div>
        <div class="toast-content">
            <div class="toast-title" id="toast-title">Sucesso!</div>
            <div class="toast-message" id="toast-message">Operação realizada com sucesso.</div>
        </div>
        <button class="toast-close" onclick="hideToast()">&times;</button>
    </div>

    <script>
        // Sistema completo com CRUD para tudo
        let db;
        let currentEditingId = null;
        let transactionsChart = null;
        let currentChartType = 'bar';
        
        // Inicialização do IndexedDB
        const request = indexedDB.open("FluxoMasterPro_DB", 5);
        
        request.onupgradeneeded = function(event) {
            db = event.target.result;
            
            // Criar object stores se não existirem
            if (!db.objectStoreNames.contains("clientes")) {
                const clientStore = db.createObjectStore("clientes", { keyPath: "id", autoIncrement: true });
                clientStore.createIndex("nome", "nome", { unique: false });
                clientStore.createIndex("status", "status", { unique: false });
                clientStore.createIndex("dataCadastro", "dataCadastro", { unique: false });
            }
            
            if (!db.objectStoreNames.contains("transacoes")) {
                const transStore = db.createObjectStore("transacoes", { keyPath: "id", autoIncrement: true });
                transStore.createIndex("tipo", "tipo", { unique: false });
                transStore.createIndex("categoria", "categoria", { unique: false });
                transStore.createIndex("cliente", "cliente", { unique: false });
                transStore.createIndex("data", "data", { unique: false });
            }
            
            if (!db.objectStoreNames.contains("categorias")) {
                const catStore = db.createObjectStore("categorias", { keyPath: "id", autoIncrement: true });
                catStore.createIndex("tipo", "tipo", { unique: false });
                
                // Inicializar categorias padrão
                const defaultCategories = [
                    { nome: "Vendas", tipo: "Entrada", cor: "#4CC9A7", descricao: "Receitas de vendas" },
                    { nome: "Serviços", tipo: "Entrada", cor: "#36B5E8", descricao: "Receitas de serviços prestados" },
                    { nome: "Salários", tipo: "Saída", cor: "#FF5A5F", descricao: "Pagamento de salários" },
                    { nome: "Fornecedores", tipo: "Saída", cor: "#FFB74D", descricao: "Pagamentos a fornecedores" },
                    { nome: "Manutenção", tipo: "Saída", cor: "#6C63FF", descricao: "Custos de manutenção" },
                    { nome: "Marketing", tipo: "Saída", cor: "#FF6584", descricao: "Investimentos em marketing" },
                    { nome: "Aluguel", tipo: "Saída", cor: "#8C8CA1", descricao: "Pagamento de aluguel" }
                ];
                
                defaultCategories.forEach(cat => {
                    catStore.add(cat);
                });
            }
            
            if (!db.objectStoreNames.contains("config")) {
                const configStore = db.createObjectStore("config", { keyPath: "id" });
                configStore.add({ 
                    id: 1,
                    chave: "usuario", 
                    valor: { 
                        nome: "Administrador", 
                        empresa: "Minha Empresa",
                        cidade: "Jaraguá do Sul",
                        email: "",
                        avatar: null
                    } 
                });
            }
        };
        
        request.onsuccess = function(event) {
            db = event.target.result;
            initApp();
        };
        
        request.onerror = function(event) {
            console.error("Erro ao abrir banco de dados:", event);
            showToast("Erro", "Não foi possível carregar o sistema. Recarregue a página.", "error");
        };
        
        // Inicialização da aplicação
        function initApp() {
            updateCurrentDate();
            renderAll();
            loadUserSettings();
            updateDashboardBadges();
            
            // Configurar eventos dos formulários
            document.getElementById('client-form').onsubmit = saveClient;
            document.getElementById('category-form').onsubmit = saveCategory;
            document.getElementById('transaction-form').onsubmit = saveTransaction;
            
            // Preencher data atual nos campos de data
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('transaction-date').value = today;
            document.getElementById('client-date').value = today;
            
            // Configurar datas para filtros
            document.getElementById('filter-date-from').value = today;
            document.getElementById('filter-date-to').value = today;
            document.getElementById('chart-date-from').value = today;
            document.getElementById('chart-date-to').value = today;
            
            // Carregar opções de categorias e clientes
            updateCategoryOptions();
            updateClientOptions();
            updateFilterOptions();
            
            // Validar formulários
            setupFormValidation();
            
            // Mostrar mensagem de boas-vindas
            setTimeout(() => {
                showToast("Bem-vindo ao FluxoMaster Pro", "Sistema carregado com sucesso!", "success");
            }, 1000);
        }
        
        // Validações de formulário
        function setupFormValidation() {
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.addEventListener('submit', function(e) {
                    const inputs = form.querySelectorAll('input[required], select[required]');
                    let isValid = true;
                    
                    inputs.forEach(input => {
                        if (!input.value.trim()) {
                            input.classList.add('error');
                            isValid = false;
                        } else {
                            input.classList.remove('error');
                        }
                    });
                    
                    if (!isValid) {
                        e.preventDefault();
                        showToast("Atenção", "Preencha todos os campos obrigatórios.", "error");
                    }
                });
            });
        }
        
        // Funções de validação
        function lettersOnly(event) {
            const char = String.fromCharCode(event.keyCode);
            const pattern = /[a-zA-ZáàâãéèêíïóôõöúçñÁÀÂÃÉÈÊÍÏÓÔÕÖÚÇÑ\s]/;
            if (!pattern.test(char)) {
                event.preventDefault();
                return false;
            }
            return true;
        }
        
        function numbersOnly(event) {
            const char = String.fromCharCode(event.keyCode);
            const pattern = /[0-9]/;
            if (!pattern.test(char)) {
                event.preventDefault();
                return false;
            }
            return true;
        }
        
        // Atualizar data atual
        function updateCurrentDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('pt-BR', options);
        }
        
        // Navegação entre seções
        function showSection(id) {
            // Esconder todas as seções
            document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
            
            // Remover classe ativa de todos os itens de navegação
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            // Mostrar seção selecionada
            document.getElementById('sec-' + id).style.display = 'block';
            
            // Ativar item de navegação correspondente
            document.querySelector(`.nav-item[onclick="showSection('${id}')"]`).classList.add('active');
            
            // Atualizar dados específicos da seção
            if (id === 'relatorios') {
                generateReport();
                updateChart();
            }
            
            // Atualizar badges
            updateDashboardBadges();
        }
        
        // Renderizar todos os dados
        function renderAll() {
            updateDashboard();
            renderClientes();
            renderTransactions();
            renderCategories();
            updateFilterOptions();
        }
        
        // Atualizar badges da sidebar
        function updateDashboardBadges() {
            // Atualizar badge de clientes
            db.transaction("clientes", "readonly").objectStore("clientes").count().onsuccess = function(e) {
                const count = e.target.result;
                document.getElementById('clientes-badge').textContent = count;
                document.getElementById('total-clientes').textContent = count;
            };
            
            // Atualizar badge de transações
            db.transaction("transacoes", "readonly").objectStore("transacoes").count().onsuccess = function(e) {
                document.getElementById('financeiro-badge').textContent = e.target.result;
            };
            
            // Atualizar badge de categorias
            db.transaction("categorias", "readonly").objectStore("categorias").count().onsuccess = function(e) {
                document.getElementById('categorias-badge').textContent = e.target.result;
                document.getElementById('categoria-count').textContent = e.target.result + ' categorias';
            };
        }
        
        // ========== DASHBOARD ==========
        function updateDashboard() {
            const dashboardBody = document.getElementById('dashboard-transactions');
            const emptyDashboard = document.getElementById('empty-dashboard');
            
            let totalIncome = 0;
            let totalExpenses = 0;
            let totalClients = 0;
            let latestTransactions = [];
            
            // Contar clientes
            db.transaction("clientes", "readonly").objectStore("clientes").count().onsuccess = function(e) {
                totalClients = e.target.result;
                calculateTransactions();
            };
            
            function calculateTransactions() {
                // Calcular totais e pegar últimas transações
                db.transaction("transacoes", "readonly").objectStore("transacoes").openCursor(null, "prev").onsuccess = function(e) {
                    const cursor = e.target.result;
                    
                    if (cursor && latestTransactions.length < 10) {
                        const transaction = cursor.value;
                        
                        if (transaction.tipo === 'Entrada') {
                            totalIncome += parseFloat(transaction.valor) || 0;
                        } else {
                            totalExpenses += parseFloat(transaction.valor) || 0;
                        }
                        
                        latestTransactions.push(transaction);
                        cursor.continue();
                    } else {
                        // Calcular saldo
                        const balance = totalIncome - totalExpenses;
                        
                        // Atualizar estatísticas
                        document.getElementById('total-in').textContent = formatCurrency(totalIncome);
                        document.getElementById('total-out').textContent = formatCurrency(totalExpenses);
                        document.getElementById('total-saldo').textContent = formatCurrency(balance);
                        document.getElementById('total-clientes').textContent = totalClients;
                        
                        // Atualizar dashboard do mês
                        updateMonthDashboard();
                        
                        // Renderizar últimas transações
                        if (latestTransactions.length > 0) {
                            dashboardBody.innerHTML = '';
                            latestTransactions.forEach(transaction => {
                                const isIncome = transaction.tipo === 'Entrada';
                                
                                dashboardBody.innerHTML += `
                                    <tr>
                                        <td>${formatDate(transaction.data)}</td>
                                        <td><span class="tag ${isIncome ? 'tag-entrada' : 'tag-saida'}">${transaction.tipo}</span></td>
                                        <td>${transaction.descricao}</td>
                                        <td>${transaction.categoria}</td>
                                        <td><strong style="color: ${isIncome ? 'var(--success)' : 'var(--danger)'}">${formatCurrency(transaction.valor)}</strong></td>
                                        <td>
                                            <button class="btn btn-warning btn-icon btn-sm" onclick="editTransaction(${transaction.id})" title="Editar">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-danger btn-icon btn-sm" onclick="deleteTransaction(${transaction.id})" title="Excluir">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                `;
                            });
                            
                            emptyDashboard.style.display = 'none';
                        } else {
                            dashboardBody.innerHTML = '';
                            emptyDashboard.style.display = 'block';
                        }
                    }
                };
            }
        }
        
        function updateMonthDashboard() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            let monthIncome = 0;
            let monthExpenses = 0;
            
            db.transaction("transacoes", "readonly").objectStore("transacoes").openCursor().onsuccess = function(e) {
                const cursor = e.target.result;
                
                if (cursor) {
                    const transaction = cursor.value;
                    const transactionDate = new Date(transaction.data);
                    
                    if (transactionDate.getMonth() === currentMonth && transactionDate.getFullYear() === currentYear) {
                        if (transaction.tipo === 'Entrada') {
                            monthIncome += parseFloat(transaction.valor) || 0;
                        } else {
                            monthExpenses += parseFloat(transaction.valor) || 0;
                        }
                    }
                    
                    cursor.continue();
                } else {
                    const monthBalance = monthIncome - monthExpenses;
                    
                    document.getElementById('month-balance').textContent = formatCurrency(monthBalance);
                    document.getElementById('month-income').textContent = formatCurrency(monthIncome);
                    document.getElementById('month-expenses').textContent = formatCurrency(monthExpenses);
                }
            };
        }
        
        function filterDashboard(period) {
            updateDashboard();
        }
        
        // ========== CLIENTES (CRUD COMPLETO) ==========
        function renderClientes() {
            const clientesBody = document.getElementById('clientes-body');
            const emptyClientes = document.getElementById('empty-clientes');
            
            clientesBody.innerHTML = '';
            
            db.transaction("clientes", "readonly").objectStore("clientes").openCursor().onsuccess = function(e) {
                const cursor = e.target.result;
                
                if (cursor) {
                    emptyClientes.style.display = 'none';
                    const cliente = cursor.value;
                    
                    // Buscar última transação do cliente
                    getLastTransactionForClient(cliente.id).then(lastTransaction => {
                        clientesBody.innerHTML += `
                            <tr>
                                <td>
                                    <div style="font-weight: 700; color: var(--dark);">${cliente.nome}</div>
                                    <div style="font-size: 12px; color: var(--gray);">${cliente.documento || 'Sem documento'}</div>
                                </td>
                                <td>
                                    <div>${cliente.telefone || 'Não informado'}</div>
                                    <div style="font-size: 12px; color: var(--gray);">${cliente.email || ''}</div>
                                </td>
                                <td>
                                    <div>${cliente.cidade}, ${cliente.estado}</div>
                                    <div style="font-size: 12px; color: var(--gray);">${cliente.endereco || ''}</div>
                                </td>
                                <td>
                                    ${lastTransaction ? `
                                        <div>${formatCurrency(lastTransaction.valor)}</div>
                                        <div style="font-size: 12px; color: var(--gray);">${formatDate(lastTransaction.data)}</div>
                                    ` : 'Nenhuma transação'}
                                </td>
                                <td>
                                    <span style="
                                        padding: 4px 12px;
                                        border-radius: 20px;
                                        font-size: 12px;
                                        font-weight: 600;
                                        background: ${cliente.status === 'ativo' ? 'rgba(76, 201, 167, 0.1)' : 
                                                     cliente.status === 'inativo' ? 'rgba(255, 90, 95, 0.1)' : 
                                                     'rgba(255, 182, 77, 0.1)'};
                                        color: ${cliente.status === 'ativo' ? 'var(--success)' : 
                                                cliente.status === 'inativo' ? 'var(--danger)' : 
                                                'var(--warning)'};
                                    ">
                                        ${cliente.status === 'ativo' ? 'Ativo' : 
                                          cliente.status === 'inativo' ? 'Inativo' : 'Potencial'}
                                    </span>
                                </td>
                                <td>
                                    <button class="btn btn-warning btn-icon btn-sm" onclick="editClient(${cliente.id})" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-danger btn-icon btn-sm" onclick="deleteClient(${cliente.id})" title="Excluir">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                    });
                    
                    cursor.continue();
                } else if (clientesBody.innerHTML === '') {
                    emptyClientes.style.display = 'block';
                }
                
                // Atualizar contador
                document.getElementById('client-count').textContent = `${document.querySelectorAll('#clientes-body tr').length} clientes`;
            };
        }
        
        function getLastTransactionForClient(clientId) {
            return new Promise((resolve) => {
                let lastTransaction = null;
                
                db.transaction("transacoes", "readonly").objectStore("transacoes").openCursor(null, "prev").onsuccess = function(e) {
                    const cursor = e.target.result;
                    
                    if (cursor) {
                        const transaction = cursor.value;
                        // Verificar se há cliente associado
                        if (transaction.cliente) {
                            // Buscar o cliente pelo nome
                            db.transaction("clientes", "readonly").objectStore("clientes").get(clientId).onsuccess = function(e) {
                                const cliente = e.target.result;
                                if (cliente && transaction.cliente === cliente.nome) {
                                    lastTransaction = transaction;
                                }
                            };
                        }
                        cursor.continue();
                    } else {
                        resolve(lastTransaction);
                    }
                };
            });
        }
        
        function openClientModal(clientId = null) {
            currentEditingId = clientId;
            const modal = document.getElementById('client-modal');
            const title = document.getElementById('client-modal-title');
            
            if (clientId) {
                title.textContent = 'Editar Cliente';
                
                // Carregar dados do cliente
                db.transaction("clientes", "readonly").objectStore("clientes").get(clientId).onsuccess = function(e) {
                    const cliente = e.target.result;
                    
                    if (cliente) {
                        document.getElementById('client-id').value = cliente.id;
                        document.getElementById('client-nome').value = cliente.nome || '';
                        document.getElementById('client-tel').value = cliente.telefone || '';
                        document.getElementById('client-email').value = cliente.email || '';
                        document.getElementById('client-document').value = cliente.documento || '';
                        document.getElementById('client-address').value = cliente.endereco || '';
                        document.getElementById('client-city').value = cliente.cidade || 'Jaraguá do Sul';
                        document.getElementById('client-state').value = cliente.estado || 'SC';
                        document.getElementById('client-date').value = cliente.dataCadastro || new Date().toISOString().split('T')[0];
                        document.getElementById('client-status').value = cliente.status || 'ativo';
                    }
                };
            } else {
                title.textContent = 'Novo Cliente';
                document.getElementById('client-form').reset();
                document.getElementById('client-id').value = '';
                document.getElementById('client-city').value = 'Jaraguá do Sul';
                document.getElementById('client-state').value = 'SC';
                document.getElementById('client-date').value = new Date().toISOString().split('T')[0];
                document.getElementById('client-status').value = 'ativo';
            }
            
            modal.classList.add('active');
        }
        
        function saveClient(e) {
            e.preventDefault();
            
            const cliente = {
                nome: document.getElementById('client-nome').value,
                telefone: document.getElementById('client-tel').value,
                email: document.getElementById('client-email').value,
                documento: document.getElementById('client-document').value,
                endereco: document.getElementById('client-address').value,
                cidade: document.getElementById('client-city').value,
                estado: document.getElementById('client-state').value,
                dataCadastro: document.getElementById('client-date').value,
                status: document.getElementById('client-status').value,
                dataAtualizacao: new Date().toISOString()
            };
            
            const transaction = db.transaction("clientes", "readwrite");
            const store = transaction.objectStore("clientes");
            
            if (currentEditingId) {
                cliente.id = parseInt(currentEditingId);
                store.put(cliente);
            } else {
                store.add(cliente);
            }
            
            transaction.oncomplete = function() {
                closeModal();
                renderAll();
                updateClientOptions();
                showToast(
                    "Cliente salvo",
                    currentEditingId ? "Cliente atualizado com sucesso!" : "Cliente cadastrado com sucesso!",
                    "success"
                );
                currentEditingId = null;
            };
            
            transaction.onerror = function() {
                showToast("Erro", "Não foi possível salvar o cliente.", "error");
            };
        }
        
        function editClient(id) {
            openClientModal(id);
        }
        
        function deleteClient(id) {
            if (confirm("Tem certeza que deseja excluir este cliente? Esta ação não pode ser desfeita.")) {
                db.transaction("clientes", "readwrite").objectStore("clientes").delete(id).onsuccess = function() {
                    renderAll();
                    updateClientOptions();
                    showToast("Cliente excluído", "Cliente removido do sistema.", "success");
                };
            }
        }
        
        // Atualizar opções de clientes nos selects
        function updateClientOptions() {
            const transactionClientSelect = document.getElementById('transaction-client');
            const filterClientSelect = document.getElementById('filter-client');
            
            // Limpar opções existentes, mantendo a primeira
            while (transactionClientSelect.options.length > 1) {
                transactionClientSelect.remove(1);
            }
            
            while (filterClientSelect.options.length > 1) {
                filterClientSelect.remove(1);
            }
            
            db.transaction("clientes", "readonly").objectStore("clientes").openCursor().onsuccess = function(e) {
                const cursor = e.target.result;
                
                if (cursor) {
                    const cliente = cursor.value;
                    
                    const option1 = document.createElement('option');
                    option1.value = cliente.nome;
                    option1.textContent = cliente.nome;
                    transactionClientSelect.appendChild(option1);
                    
                    const option2 = document.createElement('option');
                    option2.value = cliente.nome;
                    option2.textContent = cliente.nome;
                    filterClientSelect.appendChild(option2);
                    
                    cursor.continue();
                }
            };
        }
        
        // ========== CATEGORIAS (CRUD COMPLETO) ==========
        function renderCategories() {
            const categoriesBody = document.getElementById('categories-body');
            const emptyCategories = document.getElementById('empty-categories');
            
            categoriesBody.innerHTML = '';
            
            db.transaction("categorias", "readonly").objectStore("categorias").openCursor().onsuccess = function(e) {
                const cursor = e.target.result;
                
                if (cursor) {
                    emptyCategories.style.display = 'none';
                    const categoria = cursor.value;
                    
                    // Contar transações desta categoria
                    db.transaction("transacoes", "readonly").objectStore("transacoes").index("categoria").count(categoria.nome).onsuccess = function(e) {
                        const transactionCount = e.target.result;
                        
                        categoriesBody.innerHTML += `
                            <tr data-category-id="${categoria.id}">
                                <td>
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <div style="width: 16px; height: 16px; border-radius: 4px; background: ${categoria.cor || '#6C63FF'}"></div>
                                        <div style="font-weight: 700; color: var(--dark);">${categoria.nome}</div>
                                    </div>
                                    ${categoria.descricao ? `<div style="font-size: 12px; color: var(--gray); margin-top: 5px;">${categoria.descricao}</div>` : ''}
                                </td>
                                <td>
                                    <span class="tag ${categoria.tipo === 'Entrada' ? 'tag-entrada' : 'tag-saida'}">
                                        ${categoria.tipo}
                                    </span>
                                </td>
                                <td>
                                    <input type="color" value="${categoria.cor || '#6C63FF'}" style="width: 40px; height: 40px; border: none; cursor: pointer;" 
                                           onchange="updateCategoryColor(${categoria.id}, this.value)" title="Clique para alterar a cor">
                                </td>
                                <td>
                                    <div style="font-weight: 700; color: var(--dark);">${transactionCount}</div>
                                    <div style="font-size: 12px; color: var(--gray);">transações</div>
                                </td>
                                <td>
                                    <button class="btn btn-warning btn-icon btn-sm" onclick="editCategory(${categoria.id})" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-danger btn-icon btn-sm" onclick="deleteCategory(${categoria.id})" title="Excluir">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                    };
                    
                    cursor.continue();
                } else if (categoriesBody.innerHTML === '') {
                    emptyCategories.style.display = 'block';
                }
            };
        }
        
        function updateCategoryColor(id, color) {
            db.transaction("categorias", "readwrite").objectStore("categorias").get(id).onsuccess = function(e) {
                const categoria = e.target.result;
                if (categoria) {
                    categoria.cor = color;
                    db.transaction("categorias", "readwrite").objectStore("categorias").put(categoria).onsuccess = function() {
                        renderCategories();
                        showToast("Cor atualizada", "A cor da categoria foi alterada.", "success");
                    };
                }
            };
        }
        
        function openCategoryModal(categoryId = null) {
            currentEditingId = categoryId;
            const modal = document.getElementById('category-modal');
            const title = document.getElementById('category-modal-title');
            
            if (categoryId) {
                title.textContent = 'Editar Categoria';
                
                // Carregar dados da categoria
                db.transaction("categorias", "readonly").objectStore("categorias").get(categoryId).onsuccess = function(e) {
                    const categoria = e.target.result;
                    
                    if (categoria) {
                        document.getElementById('category-id').value = categoria.id;
                        document.getElementById('category-name').value = categoria.nome || '';
                        document.getElementById('category-type').value = categoria.tipo || 'Entrada';
                        document.getElementById('category-color').value = categoria.cor || '#6C63FF';
                        document.getElementById('category-budget').value = categoria.orcamento || '';
                        document.getElementById('category-description').value = categoria.descricao || '';
                    }
                };
            } else {
                title.textContent = 'Nova Categoria';
                document.getElementById('category-form').reset();
                document.getElementById('category-id').value = '';
                document.getElementById('category-type').value = 'Entrada';
                document.getElementById('category-color').value = '#6C63FF';
            }
            
            modal.classList.add('active');
        }
        
        function saveCategory(e) {
            e.preventDefault();
            
            const categoria = {
                nome: document.getElementById('category-name').value,
                tipo: document.getElementById('category-type').value,
                cor: document.getElementById('category-color').value,
                descricao: document.getElementById('category-description').value
            };
            
            const orcamento = document.getElementById('category-budget').value;
            if (orcamento) {
                categoria.orcamento = parseFloat(orcamento);
            }
            
            const transaction = db.transaction("categorias", "readwrite");
            const store = transaction.objectStore("categorias");
            
            if (currentEditingId) {
                categoria.id = parseInt(currentEditingId);
                store.put(categoria);
            } else {
                store.add(categoria);
            }
            
            transaction.oncomplete = function() {
                closeModal();
                renderAll();
                updateCategoryOptions();
                updateFilterOptions();
                showToast(
                    "Categoria salva",
                    currentEditingId ? "Categoria atualizada com sucesso!" : "Categoria criada com sucesso!",
                    "success"
                );
                currentEditingId = null;
            };
            
            transaction.onerror = function() {
                showToast("Erro", "Não foi possível salvar a categoria.", "error");
            };
        }
        
        function editCategory(id) {
            openCategoryModal(id);
        }
        
        function deleteCategory(id) {
            if (confirm("Tem certeza que deseja excluir esta categoria? As transações associadas ficarão sem categoria.")) {
                db.transaction("categorias", "readwrite").objectStore("categorias").delete(id).onsuccess = function() {
                    renderAll();
                    updateCategoryOptions();
                    updateFilterOptions();
                    showToast("Categoria excluída", "Categoria removida do sistema.", "success");
                };
            }
        }
        
        function filterCategories() {
            const filterType = document.getElementById('filter-category-type').value;
            const rows = document.querySelectorAll('#categories-body tr');
            
            rows.forEach(row => {
                const typeCell = row.querySelector('td:nth-child(2)');
                const typeText = typeCell.textContent.trim();
                
                if (filterType === 'all' || 
                    (filterType === 'Entrada' && typeText === 'Entrada') ||
                    (filterType === 'Saída' && typeText === 'Saída')) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function searchCategories(query) {
            const rows = document.querySelectorAll('#categories-body tr');
            
            rows.forEach(row => {
                const nameCell = row.querySelector('td:nth-child(1) div:nth-child(2)');
                const name = nameCell.textContent.toLowerCase();
                
                if (name.includes(query.toLowerCase())) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function resetDefaultCategories() {
            if (confirm("Isso irá restaurar as categorias padrão. Suas categorias personalizadas serão mantidas. Continuar?")) {
                const defaultCategories = [
                    { nome: "Vendas", tipo: "Entrada", cor: "#4CC9A7", descricao: "Receitas de vendas" },
                    { nome: "Serviços", tipo: "Entrada", cor: "#36B5E8", descricao: "Receitas de serviços prestados" },
                    { nome: "Salários", tipo: "Saída", cor: "#FF5A5F", descricao: "Pagamento de salários" },
                    { nome: "Fornecedores", tipo: "Saída", cor: "#FFB74D", descricao: "Pagamentos a fornecedores" },
                    { nome: "Manutenção", tipo: "Saída", cor: "#6C63FF", descricao: "Custos de manutenção" },
                    { nome: "Marketing", tipo: "Saída", cor: "#FF6584", descricao: "Investimentos em marketing" },
                    { nome: "Aluguel", tipo: "Saída", cor: "#8C8CA1", descricao: "Pagamento de aluguel" }
                ];
                
                const transaction = db.transaction("categorias", "readwrite");
                const store = transaction.objectStore("categorias");
                
                // Primeiro, limpar todas as categorias existentes
                store.clear().onsuccess = function() {
                    // Adicionar categorias padrão
                    defaultCategories.forEach(cat => {
                        store.add(cat);
                    });
                    
                    transaction.oncomplete = function() {
                        renderAll();
                        updateCategoryOptions();
                        updateFilterOptions();
                        showToast("Categorias restauradas", "Categorias padrão foram restauradas.", "success");
                    };
                };
            }
        }
        
        // Atualizar opções de categorias nos selects
        function updateCategoryOptions() {
            const transactionCategorySelect = document.getElementById('transaction-category');
            const type = document.getElementById('transaction-type').value;
            
            transactionCategorySelect.innerHTML = '';
            
            db.transaction("categorias", "readonly").objectStore("categorias").openCursor().onsuccess = function(e) {
                const cursor = e.target.result;
                
                if (cursor) {
                    if (cursor.value.tipo === type) {
                        const option = document.createElement('option');
                        option.value = cursor.value.nome;
                        option.textContent = cursor.value.nome;
                        transactionCategorySelect.appendChild(option);
                    }
                    cursor.continue();
                }
            };
        }
        
        // ========== TRANSAÇÕES ==========
        function renderTransactions(filteredTransactions = null) {
            const transactionsBody = document.getElementById('transactions-body');
            const emptyTransactions = document.getElementById('empty-transactions');
            
            transactionsBody.innerHTML = '';
            
            const processTransactions = (cursor) => {
                if (cursor) {
                    emptyTransactions.style.display = 'none';
                    const transaction = cursor.value;
                    const isIncome = transaction.tipo === 'Entrada';
                    
                    // Aplicar filtros
                    const shouldShow = applyFiltersToTransaction(transaction);
                    
                    if (shouldShow) {
                        transactionsBody.innerHTML += `
                            <tr>
                                <td>${formatDate(transaction.data)}</td>
                                <td><span class="tag ${isIncome ? 'tag-entrada' : 'tag-saida'}">${transaction.tipo}</span></td>
                                <td>${transaction.descricao}</td>
                                <td>${transaction.categoria}</td>
                                <td>${transaction.cliente || 'Sem cliente'}</td>
                                <td><strong style="color: ${isIncome ? 'var(--success)' : 'var(--danger)'}">${formatCurrency(transaction.valor)}</strong></td>
                                <td>
                                    <button class="btn btn-warning btn-icon btn-sm" onclick="editTransaction(${transaction.id})" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-danger btn-icon btn-sm" onclick="deleteTransaction(${transaction.id})" title="Excluir">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                    }
                    
                    cursor.continue();
                } else if (transactionsBody.innerHTML === '') {
                    emptyTransactions.style.display = 'block';
                }
            };
            
            if (filteredTransactions) {
                // Ordenar transações
                const sortOption = document.getElementById('filter-sort').value;
                filteredTransactions.sort((a, b) => {
                    switch(sortOption) {
                        case 'date-asc': return new Date(a.data) - new Date(b.data);
                        case 'date-desc': return new Date(b.data) - new Date(a.data);
                        case 'value-asc': return a.valor - b.valor;
                        case 'value-desc': return b.valor - a.valor;
                        default: return new Date(b.data) - new Date(a.data);
                    }
                });
                
                // Processar transações filtradas
                filteredTransactions.forEach(transaction => {
                    const isIncome = transaction.tipo === 'Entrada';
                    transactionsBody.innerHTML += `
                        <tr>
                            <td>${formatDate(transaction.data)}</td>
                            <td><span class="tag ${isIncome ? 'tag-entrada' : 'tag-saida'}">${transaction.tipo}</span></td>
                            <td>${transaction.descricao}</td>
                            <td>${transaction.categoria}</td>
                            <td>${transaction.cliente || 'Sem cliente'}</td>
                            <td><strong style="color: ${isIncome ? 'var(--success)' : 'var(--danger)'}">${formatCurrency(transaction.valor)}</strong></td>
                            <td>
                                <button class="btn btn-warning btn-icon btn-sm" onclick="editTransaction(${transaction.id})" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-icon btn-sm" onclick="deleteTransaction(${transaction.id})" title="Excluir">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                if (filteredTransactions.length === 0) {
                    emptyTransactions.style.display = 'block';
                }
            } else {
                // Carregar todas as transações
                const sortOption = document.getElementById('filter-sort').value;
                const direction = sortOption.includes('desc') ? 'prev' : 'next';
                
                db.transaction("transacoes", "readonly").objectStore("transacoes").openCursor(null, direction).onsuccess = function(e) {
                    processTransactions(e.target.result);
                };
            }
        }
        
        function applyFiltersToTransaction(transaction) {
            const period = document.getElementById('filter-period').value;
            const type = document.getElementById('filter-type').value;
            const category = document.getElementById('filter-category').value;
            const client = document.getElementById('filter-client').value;
            const dateFrom = document.getElementById('filter-date-from').value;
            const dateTo = document.getElementById('filter-date-to').value;
            
            // Filtrar por tipo
            if (type !== 'all' && transaction.tipo !== type) {
                return false;
            }
            
            // Filtrar por categoria
            if (category !== 'all' && transaction.categoria !== category) {
                return false;
            }
            
            // Filtrar por cliente
            if (client !== 'all' && transaction.cliente !== client) {
                return false;
            }
            
            // Filtrar por período
            const transactionDate = new Date(transaction.data);
            const today = new Date();
            
            switch(period) {
                case 'today':
                    if (transactionDate.toDateString() !== today.toDateString()) return false;
                    break;
                case 'week':
                    const weekAgo = new Date();
                    weekAgo.setDate(today.getDate() - 7);
                    if (transactionDate < weekAgo) return false;
                    break;
                case 'month':
                    if (transactionDate.getMonth() !== today.getMonth() || 
                        transactionDate.getFullYear() !== today.getFullYear()) return false;
                    break;
                case 'quarter':
                    const currentQuarter = Math.floor(today.getMonth() / 3);
                    const transactionQuarter = Math.floor(transactionDate.getMonth() / 3);
                    if (transactionQuarter !== currentQuarter || 
                        transactionDate.getFullYear() !== today.getFullYear()) return false;
                    break;
                case 'year':
                    if (transactionDate.getFullYear() !== today.getFullYear()) return false;
                    break;
                case 'custom':
                    if (dateFrom && transactionDate < new Date(dateFrom)) return false;
                    if (dateTo && transactionDate > new Date(dateTo)) return false;
                    break;
            }
            
            return true;
        }
        
        function openAddTransactionModal(transactionId = null) {
            currentEditingId = transactionId;
            const modal = document.getElementById('transaction-modal');
            const title = document.getElementById('transaction-modal-title');
            
            if (transactionId) {
                title.textContent = 'Editar Transação';
                
                // Carregar dados da transação
                db.transaction("transacoes", "readonly").objectStore("transacoes").get(transactionId).onsuccess = function(e) {
                    const transaction = e.target.result;
                    
                    if (transaction) {
                        document.getElementById('transaction-id').value = transaction.id;
                        document.getElementById('transaction-type').value = transaction.tipo;
                        document.getElementById('transaction-category').value = transaction.categoria;
                        document.getElementById('transaction-client').value = transaction.cliente || '';
                        document.getElementById('transaction-value').value = transaction.valor;
                        document.getElementById('transaction-date').value = transaction.data;
                        document.getElementById('transaction-description').value = transaction.descricao;
                        document.getElementById('transaction-notes').value = transaction.observacoes || '';
                        
                        updateCategoryOptions();
                    }
                };
            } else {
                title.textContent = 'Nova Transação';
                document.getElementById('transaction-form').reset();
                document.getElementById('transaction-id').value = '';
                document.getElementById('transaction-date').value = new Date().toISOString().split('T')[0];
                document.getElementById('transaction-type').value = 'Entrada';
                updateCategoryOptions();
            }
            
            modal.classList.add('active');
        }
        
        function saveTransaction(e) {
            e.preventDefault();
            
            const transaction = {
                tipo: document.getElementById('transaction-type').value,
                categoria: document.getElementById('transaction-category').value,
                cliente: document.getElementById('transaction-client').value || null,
                valor: parseFloat(document.getElementById('transaction-value').value) || 0,
                data: document.getElementById('transaction-date').value,
                descricao: document.getElementById('transaction-description').value,
                observacoes: document.getElementById('transaction-notes').value,
                dataRegistro: new Date().toISOString()
            };
            
            const dbTransaction = db.transaction("transacoes", "readwrite");
            const store = dbTransaction.objectStore("transacoes");
            
            if (currentEditingId) {
                transaction.id = parseInt(currentEditingId);
                store.put(transaction);
            } else {
                store.add(transaction);
            }
            
            dbTransaction.oncomplete = function() {
                closeModal();
                renderAll();
                document.getElementById('last-update').textContent = "Agora";
                showToast(
                    "Transação salva",
                    currentEditingId ? "Transação atualizada com sucesso!" : "Transação registrada com sucesso!",
                    "success"
                );
                currentEditingId = null;
            };
            
            dbTransaction.onerror = function() {
                showToast("Erro", "Não foi possível salvar a transação.", "error");
            };
        }
        
        function editTransaction(id) {
            openAddTransactionModal(id);
        }
        
        function deleteTransaction(id) {
            if (confirm("Tem certeza que deseja excluir esta transação? Esta ação não pode ser desfeita.")) {
                db.transaction("transacoes", "readwrite").objectStore("transacoes").delete(id).onsuccess = function() {
                    renderAll();
                    showToast("Transação excluída", "Transação removida do sistema.", "success");
                };
            }
        }
        
        function updateFilterOptions() {
            // Atualizar filtro de categorias
            const categoryFilter = document.getElementById('filter-category');
            categoryFilter.innerHTML = '<option value="all">Todas Categorias</option>';
            
            db.transaction("categorias", "readonly").objectStore("categorias").openCursor().onsuccess = function(e) {
                const cursor = e.target.result;
                
                if (cursor) {
                    const option = document.createElement('option');
                    option.value = cursor.value.nome;
                    option.textContent = cursor.value.nome;
                    categoryFilter.appendChild(option);
                    cursor.continue();
                }
            };
            
            // Atualizar filtro de clientes
            const clientFilter = document.getElementById('filter-client');
            // Manter apenas a primeira opção
            while (clientFilter.options.length > 1) {
                clientFilter.remove(1);
            }
            
            db.transaction("clientes", "readonly").objectStore("clientes").openCursor().onsuccess = function(e) {
                const cursor = e.target.result;
                
                if (cursor) {
                    const option = document.createElement('option');
                    option.value = cursor.value.nome;
                    option.textContent = cursor.value.nome;
                    clientFilter.appendChild(option);
                    cursor.continue();
                }
            };
        }
        
        function applyFilters() {
            // Coletar todos os filtros
            const period = document.getElementById('filter-period').value;
            const type = document.getElementById('filter-type').value;
            const category = document.getElementById('filter-category').value;
            const client = document.getElementById('filter-client').value;
            const dateFrom = document.getElementById('filter-date-from').value;
            const dateTo = document.getElementById('filter-date-to').value;
            
            // Carregar todas as transações e filtrar
            db.transaction("transacoes", "readonly").objectStore("transacoes").getAll().onsuccess = function(e) {
                let filteredTransactions = e.target.result;
                
                // Aplicar filtros
                filteredTransactions = filteredTransactions.filter(transaction => {
                    // Filtrar por tipo
                    if (type !== 'all' && transaction.tipo !== type) {
                        return false;
                    }
                    
                    // Filtrar por categoria
                    if (category !== 'all' && transaction.categoria !== category) {
                        return false;
                    }
                    
                    // Filtrar por cliente
                    if (client !== 'all' && transaction.cliente !== client) {
                        return false;
                    }
                    
                    // Filtrar por período
                    const transactionDate = new Date(transaction.data);
                    const today = new Date();
                    
                    switch(period) {
                        case 'today':
                            if (transactionDate.toDateString() !== today.toDateString()) return false;
                            break;
                        case 'week':
                            const weekAgo = new Date();
                            weekAgo.setDate(today.getDate() - 7);
                            if (transactionDate < weekAgo) return false;
                            break;
                        case 'month':
                            if (transactionDate.getMonth() !== today.getMonth() || 
                                transactionDate.getFullYear() !== today.getFullYear()) return false;
                            break;
                        case 'quarter':
                            const currentQuarter = Math.floor(today.getMonth() / 3);
                            const transactionQuarter = Math.floor(transactionDate.getMonth() / 3);
                            if (transactionQuarter !== currentQuarter || 
                                transactionDate.getFullYear() !== today.getFullYear()) return false;
                            break;
                        case 'year':
                            if (transactionDate.getFullYear() !== today.getFullYear()) return false;
                            break;
                        case 'custom':
                            if (dateFrom && transactionDate < new Date(dateFrom)) return false;
                            if (dateTo && transactionDate > new Date(dateTo)) return false;
                            break;
                    }
                    
                    return true;
                });
                
                // Renderizar transações filtradas
                renderTransactions(filteredTransactions);
                showToast("Filtros aplicados", `${filteredTransactions.length} transações encontradas.`, "success");
            };
        }
        
        function clearFilters() {
            document.getElementById('filter-period').value = 'month';
            document.getElementById('filter-type').value = 'all';
            document.getElementById('filter-category').value = 'all';
            document.getElementById('filter-client').value = 'all';
            document.getElementById('filter-sort').value = 'date-desc';
            document.getElementById('custom-date-range').style.display = 'none';
            renderTransactions();
            showToast("Filtros limpos", "Todos os filtros foram removidos.", "success");
        }
        
        function toggleCustomDateRange() {
            const period = document.getElementById('filter-period').value;
            const customRange = document.getElementById('custom-date-range');
            customRange.style.display = period === 'custom' ? 'block' : 'none';
        }
        
        // ========== RELATÓRIOS E GRÁFICOS ==========
        function generateReport() {
            const reportBody = document.getElementById('report-body');
            const emptyReport = document.getElementById('empty-report');
            
            reportBody.innerHTML = '';
            
            let totalIncome = 0;
            let totalExpenses = 0;
            const categoryData = {};
            
            // Coletar dados
            db.transaction("transacoes", "readonly").objectStore("transacoes").openCursor().onsuccess = function(e) {
                const cursor = e.target.result;
                
                if (cursor) {
                    const transaction = cursor.value;
                    
                    if (transaction.tipo === 'Entrada') {
                        totalIncome += parseFloat(transaction.valor) || 0;
                    } else {
                        totalExpenses += parseFloat(transaction.valor) || 0;
                    }
                    
                    // Agrupar por categoria
                    if (!categoryData[transaction.categoria]) {
                        categoryData[transaction.categoria] = {
                            tipo: transaction.tipo,
                            quantidade: 0,
                            valor: 0
                        };
                    }
                    
                    categoryData[transaction.categoria].quantidade++;
                    categoryData[transaction.categoria].valor += parseFloat(transaction.valor) || 0;
                    
                    cursor.continue();
                } else {
                    // Calcular saldo
                    const balance = totalIncome - totalExpenses;
                    
                    // Popular tabela de categorias
                    for (const [categoria, data] of Object.entries(categoryData)) {
                        const percent = totalIncome + totalExpenses > 0 ? 
                            ((data.valor / (totalIncome + totalExpenses)) * 100).toFixed(1) : 0;
                        
                        reportBody.innerHTML += `
                            <tr>
                                <td>${categoria}</td>
                                <td><span class="tag ${data.tipo === 'Entrada' ? 'tag-entrada' : 'tag-saida'}">${data.tipo}</span></td>
                                <td>${data.quantidade}</td>
                                <td><strong>${formatCurrency(data.valor)}</strong></td>
                                <td>${percent}%</td>
                            </tr>
                        `;
                    }
                    
                    if (reportBody.innerHTML === '') {
                        emptyReport.style.display = 'block';
                    } else {
                        emptyReport.style.display = 'none';
                    }
                }
            };
        }
        
        function updateChart() {
            const period = document.getElementById('chart-period').value;
            const dateFrom = document.getElementById('chart-date-from').value;
            const dateTo = document.getElementById('chart-date-to').value;
            
            db.transaction("transacoes", "readonly").objectStore("transacoes").getAll().onsuccess = function(e) {
                const transactions = e.target.result;
                let filteredTransactions = transactions;
                
                // Filtrar por período personalizado
                if (period === 'custom' && dateFrom && dateTo) {
                    filteredTransactions = transactions.filter(t => {
                        const date = new Date(t.data);
                        return date >= new Date(dateFrom) && date <= new Date(dateTo);
                    });
                }
                
                processChartData(filteredTransactions, period);
            };
        }
        
        function processChartData(transactions, period) {
            let labels = [];
            let incomeData = [];
            let expensesData = [];
            let totalIncome = 0;
            let totalExpenses = 0;
            
            const now = new Date();
            
            // Agrupar dados por período
            if (period === 'daily') {
                // Últimos 30 dias
                for (let i = 29; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(now.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    const dayTransactions = transactions.filter(t => t.data === dateStr);
                    const dayIncome = dayTransactions.filter(t => t.tipo === 'Entrada').reduce((sum, t) => sum + (parseFloat(t.valor) || 0), 0);
                    const dayExpenses = dayTransactions.filter(t => t.tipo === 'Saída').reduce((sum, t) => sum + (parseFloat(t.valor) || 0), 0);
                    
                    labels.push(date.toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' }));
                    incomeData.push(dayIncome);
                    expensesData.push(dayExpenses);
                    
                    totalIncome += dayIncome;
                    totalExpenses += dayExpenses;
                }
            } else if (period === 'weekly') {
                // Últimas 12 semanas
                for (let i = 11; i >= 0; i--) {
                    const weekStart = new Date();
                    weekStart.setDate(now.getDate() - (i * 7));
                    const weekEnd = new Date(weekStart);
                    weekEnd.setDate(weekStart.getDate() + 6);
                    
                    const weekTransactions = transactions.filter(t => {
                        const date = new Date(t.data);
                        return date >= weekStart && date <= weekEnd;
                    });
                    
                    const weekIncome = weekTransactions.filter(t => t.tipo === 'Entrada').reduce((sum, t) => sum + (parseFloat(t.valor) || 0), 0);
                    const weekExpenses = weekTransactions.filter(t => t.tipo === 'Saída').reduce((sum, t) => sum + (parseFloat(t.valor) || 0), 0);
                    
                    labels.push(`Sem ${12-i}`);
                    incomeData.push(weekIncome);
                    expensesData.push(weekExpenses);
                    
                    totalIncome += weekIncome;
                    totalExpenses += weekExpenses;
                }
            } else if (period === 'monthly') {
                // Últimos 12 meses
                for (let i = 11; i >= 0; i--) {
                    const month = new Date();
                    month.setMonth(now.getMonth() - i);
                    
                    const monthTransactions = transactions.filter(t => {
                        const date = new Date(t.data);
                        return date.getMonth() === month.getMonth() && date.getFullYear() === month.getFullYear();
                    });
                    
                    const monthIncome = monthTransactions.filter(t => t.tipo === 'Entrada').reduce((sum, t) => sum + (parseFloat(t.valor) || 0), 0);
                    const monthExpenses = monthTransactions.filter(t => t.tipo === 'Saída').reduce((sum, t) => sum + (parseFloat(t.valor) || 0), 0);
                    
                    labels.push(month.toLocaleDateString('pt-BR', { month: 'short', year: '2-digit' }));
                    incomeData.push(monthIncome);
                    expensesData.push(monthExpenses);
                    
                    totalIncome += monthIncome;
                    totalExpenses += monthExpenses;
                }
            } else if (period === 'yearly') {
                // Últimos 5 anos
                for (let i = 4; i >= 0; i--) {
                    const year = now.getFullYear() - i;
                    
                    const yearTransactions = transactions.filter(t => {
                        const date = new Date(t.data);
                        return date.getFullYear() === year;
                    });
                    
                    const yearIncome = yearTransactions.filter(t => t.tipo === 'Entrada').reduce((sum, t) => sum + (parseFloat(t.valor) || 0), 0);
                    const yearExpenses = yearTransactions.filter(t => t.tipo === 'Saída').reduce((sum, t) => sum + (parseFloat(t.valor) || 0), 0);
                    
                    labels.push(year.toString());
                    incomeData.push(yearIncome);
                    expensesData.push(yearExpenses);
                    
                    totalIncome += yearIncome;
                    totalExpenses += yearExpenses;
                }
            } else if (period === 'custom') {
                // Período personalizado - mostrar por dia
                const dateFrom = new Date(document.getElementById('chart-date-from').value);
                const dateTo = new Date(document.getElementById('chart-date-to').value);
                const daysDiff = Math.floor((dateTo - dateFrom) / (1000 * 60 * 60 * 24));
                
                const maxDays = 30; // Limitar a 30 dias para performance
                const step = Math.max(1, Math.floor(daysDiff / maxDays));
                
                for (let i = 0; i <= daysDiff; i += step) {
                    const date = new Date(dateFrom);
                    date.setDate(date.getDate() + i);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    const dayTransactions = transactions.filter(t => t.data === dateStr);
                    const dayIncome = dayTransactions.filter(t => t.tipo === 'Entrada').reduce((sum, t) => sum + (parseFloat(t.valor) || 0), 0);
                    const dayExpenses = dayTransactions.filter(t => t.tipo === 'Saída').reduce((sum, t) => sum + (parseFloat(t.valor) || 0), 0);
                    
                    labels.push(date.toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' }));
                    incomeData.push(dayIncome);
                    expensesData.push(dayExpenses);
                    
                    totalIncome += dayIncome;
                    totalExpenses += dayExpenses;
                }
            }
            
            // Atualizar resumo
            document.getElementById('chart-total-income').textContent = formatCurrency(totalIncome);
            document.getElementById('chart-total-expenses').textContent = formatCurrency(totalExpenses);
            document.getElementById('chart-balance').textContent = formatCurrency(totalIncome - totalExpenses);
            document.getElementById('chart-transaction-count').textContent = transactions.length;
            
            // Criar ou atualizar gráfico
            const ctx = document.getElementById('transactions-chart').getContext('2d');
            
            if (transactionsChart) {
                transactionsChart.destroy();
            }
            
            const chartType = currentChartType === 'pie' && period !== 'custom' && period !== 'daily' ? 'pie' : currentChartType;
            
            if (chartType === 'pie') {
                // Gráfico de pizza para resumo
                transactionsChart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: ['Entradas', 'Saídas'],
                        datasets: [{
                            data: [totalIncome, totalExpenses],
                            backgroundColor: [getComputedStyle(document.documentElement).getPropertyValue('--success').trim(), 
                                            getComputedStyle(document.documentElement).getPropertyValue('--danger').trim()],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${formatCurrency(context.raw)}`;
                                    }
                                }
                            }
                        }
                    }
                });
            } else {
                // Gráfico de barras ou linhas
                const datasetType = chartType === 'line' ? 'line' : 'bar';
                
                transactionsChart = new Chart(ctx, {
                    type: datasetType,
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Entradas',
                                data: incomeData,
                                backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--success').trim(),
                                borderColor: getComputedStyle(document.documentElement).getPropertyValue('--success').trim(),
                                borderWidth: datasetType === 'line' ? 3 : 1
                            },
                            {
                                label: 'Saídas',
                                data: expensesData,
                                backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--danger').trim(),
                                borderColor: getComputedStyle(document.documentElement).getPropertyValue('--danger').trim(),
                                borderWidth: datasetType === 'line' ? 3 : 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: datasetType === 'bar' ? {
                            x: {
                                grid: {
                                    display: false
                                }
                            },
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'R$ ' + value.toLocaleString('pt-BR', {minimumFractionDigits: 0});
                                    }
                                }
                            }
                        } : {
                            x: {
                                grid: {
                                    display: false
                                }
                            },
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'R$ ' + value.toLocaleString('pt-BR', {minimumFractionDigits: 0});
                                    }
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${formatCurrency(context.raw)}`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Mostrar/ocultar range personalizado
            document.getElementById('chart-custom-range').style.display = period === 'custom' ? 'flex' : 'none';
        }
        
        function changeChartType(type) {
            currentChartType = type;
            
            // Atualizar botões ativos
            document.querySelectorAll('.chart-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateChart();
        }
        
        function toggleChartCustomRange() {
            const period = document.getElementById('chart-period').value;
            const customRange = document.getElementById('chart-custom-range');
            customRange.style.display = period === 'custom' ? 'flex' : 'none';
            
            if (period === 'custom') {
                updateChart();
            }
        }
        
        // ========== CONFIGURAÇÕES ==========
        function loadUserSettings() {
            db.transaction("config", "readonly").objectStore("config").get(1).onsuccess = function(e) {
                const config = e.target.result;
                
                if (config && config.valor) {
                    const user = config.valor;
                    
                    document.getElementById('user-name').textContent = user.nome;
                    document.getElementById('config-username').value = user.nome;
                    document.getElementById('config-email').value = user.email || '';
                    document.getElementById('config-company').value = user.empresa || '';
                    document.getElementById('config-city').value = user.cidade || 'Jaraguá do Sul';
                    
                    if (user.avatar) {
                        document.getElementById('avatar-container').innerHTML = `<img src="${user.avatar}" alt="Avatar">`;
                        document.getElementById('modal-avatar-preview').innerHTML = `<img src="${user.avatar}" alt="Avatar">`;
                    }
                }
            };
        }
        
        function saveSettings() {
            const user = {
                nome: document.getElementById('config-username').value,
                email: document.getElementById('config-email').value,
                empresa: document.getElementById('config-company').value,
                cidade: document.getElementById('config-city').value,
                avatar: document.querySelector('#avatar-container img')?.src || null
            };
            
            db.transaction("config", "readwrite").objectStore("config").put({ id: 1, chave: "usuario", valor: user }).onsuccess = function() {
                document.getElementById('user-name').textContent = user.nome;
                showToast("Configurações salvas", "Suas configurações foram atualizadas.", "success");
            };
        }
        
        // ========== FOTO DE PERFIL ==========
        function previewAvatar(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('modal-avatar-preview').innerHTML = `<img src="${e.target.result}" alt="Avatar">`;
                };
                reader.readAsDataURL(file);
            }
        }
        
        function openAvatarModal() {
            document.getElementById('avatar-modal').classList.add('active');
        }
        
        function saveAvatar() {
            const fileInput = document.getElementById('avatar-file-input');
            
            if (fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const avatarData = e.target.result;
                    
                    // Atualizar preview
                    document.getElementById('avatar-container').innerHTML = `<img src="${avatarData}" alt="Avatar">`;
                    
                    // Salvar no banco de dados
                    db.transaction("config", "readwrite").objectStore("config").get(1).onsuccess = function(e) {
                        const config = e.target.result;
                        
                        if (config) {
                            config.valor.avatar = avatarData;
                            db.transaction("config", "readwrite").objectStore("config").put(config).onsuccess = function() {
                                closeModal();
                                showToast("Foto atualizada", "Sua foto de perfil foi salva.", "success");
                            };
                        }
                    };
                };
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                showToast("Atenção", "Selecione uma imagem primeiro.", "error");
            }
        }
        
        function removeAvatar() {
            db.transaction("config", "readwrite").objectStore("config").get(1).onsuccess = function(e) {
                const config = e.target.result;
                
                if (config) {
                    config.valor.avatar = null;
                    db.transaction("config", "readwrite").objectStore("config").put(config).onsuccess = function() {
                        document.getElementById('avatar-container').innerHTML = `
                            <div class="avatar-placeholder">
                                <i class="fas fa-user" id="avatar-icon"></i>
                            </div>
                        `;
                        document.getElementById('modal-avatar-preview').innerHTML = `
                            <div class="upload-icon">
                                <i class="fas fa-user"></i>
                            </div>
                        `;
                        closeModal();
                        showToast("Foto removida", "Sua foto de perfil foi removida.", "success");
                    };
                }
            };
        }
        
        // ========== BACKUP E RESTAURAÇÃO ==========
        function backupData() {
            const allData = {};
            
            // Coletar todos os dados
            const stores = ['clientes', 'transacoes', 'categorias', 'config'];
            let storesProcessed = 0;
            
            stores.forEach(storeName => {
                db.transaction(storeName, "readonly").objectStore(storeName).getAll().onsuccess = function(e) {
                    allData[storeName] = e.target.result;
                    storesProcessed++;
                    
                    if (storesProcessed === stores.length) {
                        // Criar arquivo de backup
                        const dataStr = JSON.stringify(allData, null, 2);
                        const dataBlob = new Blob([dataStr], {type: 'application/json'});
                        
                        // Criar link para download
                        const link = document.createElement('a');
                        link.href = URL.createObjectURL(dataBlob);
                        link.download = `fluxomaster_backup_${new Date().toISOString().split('T')[0]}.json`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                        showToast("Backup criado", "Seus dados foram exportados com sucesso.", "success");
                    }
                };
            });
        }
        
        function exportAllData() {
            backupData(); // Mesma função
        }
        
        function importAllData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (confirm("Isso substituirá todos os dados atuais. Tem certeza?")) {
                            // Limpar todos os dados existentes
                            const stores = ['clientes', 'transacoes', 'categorias', 'config'];
                            let storesCleared = 0;
                            
                            stores.forEach(storeName => {
                                const transaction = db.transaction(storeName, "readwrite");
                                const store = transaction.objectStore(storeName);
                                
                                store.clear().onsuccess = function() {
                                    // Adicionar novos dados
                                    if (data[storeName]) {
                                        data[storeName].forEach(item => {
                                            store.add(item);
                                        });
                                    }
                                    
                                    storesCleared++;
                                    
                                    if (storesCleared === stores.length) {
                                        setTimeout(() => {
                                            location.reload();
                                        }, 1000);
                                        
                                        showToast("Dados importados", "Sistema reiniciado com os dados do backup.", "success");
                                    }
                                };
                            });
                        }
                    } catch (error) {
                        showToast("Erro", "Arquivo de backup inválido.", "error");
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // ========== UTILITÁRIOS ==========
        function closeModal() {
            document.querySelectorAll('.modal').forEach(modal => modal.classList.remove('active'));
            currentEditingId = null;
        }
        
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }
        
        function showToast(title, message, type = "success") {
            const toast = document.getElementById('toast');
            const toastTitle = document.getElementById('toast-title');
            const toastMessage = document.getElementById('toast-message');
            const toastIcon = toast.querySelector('.toast-icon i');
            
            toast.className = `toast toast-${type}`;
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            
            if (type === "success") {
                toastIcon.className = "fas fa-check";
            } else if (type === "error") {
                toastIcon.className = "fas fa-times";
            } else {
                toastIcon.className = "fas fa-info-circle";
            }
            
            toast.classList.add('show');
            
            setTimeout(() => {
                hideToast();
            }, 5000);
        }
        
        function hideToast() {
            document.getElementById('toast').classList.remove('show');
        }
        
        function resetSystemWithConfirmation() {
            const response = prompt("TEM CERTEZA ABSOLUTA QUE DESEJA RESETAR O SISTEMA?\n\nIsso apagará TODOS os dados: clientes, transações, categorias e configurações.\n\nDigite 'RESETAR' para confirmar:");
            
            if (response === 'RESETAR') {
                if (confirm("ÚLTIMA CONFIRMAÇÃO: Todos os dados serão PERDIDOS para sempre. Continuar?")) {
                    indexedDB.deleteDatabase("FluxoMasterPro_DB");
                    showToast("Sistema resetado", "Recarregue a página para iniciar um novo sistema.", "success");
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                }
            } else if (response !== null) {
                showToast("Cancelado", "Reset do sistema cancelado.", "error");
            }
        }
        
        function resetSystem() {
            resetSystemWithConfirmation(); // Usar a nova função com proteção
        }
        
        // Funções auxiliares
        function printTransactions() {
            window.print();
        }
        
        function exportTransactions() {
            showToast("Exportar", "Exportando transações...", "info");
            // Implementação básica
            backupData();
        }
        
        function exportClientes() {
            showToast("Exportar", "Exportando clientes...", "info");
            // Implementação básica
            backupData();
        }
        
        function importClientes() {
            showToast("Importar", "Use a função de importar backup nas configurações", "info");
        }
        
        function generatePDFReport() {
            showToast("PDF", "Gerando relatório em PDF...", "info");
            // Implementação básica
            const canvas = document.getElementById('transactions-chart');
            if (canvas) {
                const link = document.createElement('a');
                link.download = `relatorio_fluxomaster_${new Date().toISOString().split('T')[0]}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            }
            showToast("PDF", "Gráfico exportado como imagem.", "success");
        }
        
        // Configurar eventos
        document.getElementById('chart-period').addEventListener('change', function() {
            toggleChartCustomRange();
            updateChart();
        });
        
        document.getElementById('chart-date-from').addEventListener('change', updateChart);
        document.getElementById('chart-date-to').addEventListener('change', updateChart);
        
        // Prevenir fechamento acidental
        window.addEventListener('beforeunload', function(e) {
            // Comentado para não incomodar durante desenvolvimento
            // e.preventDefault();
            // e.returnValue = '';
        });
        
        // Inicializar gráfico quando a página carregar
        window.addEventListener('load', function() {
            updateChart();
        });
    </script>
</body>
</html>